<%= panda_form_with model: post, url: url, method: post.persisted? ? :put : :post do |f| %>
  <%= render Panda::Core::Admin::FormErrorComponent.new(model: post) %>

  <%= render Panda::Core::Admin::PanelComponent.new do |panel| %>
    <% panel.with_heading_slot { "Post Settings" } %>
    <div class="space-y-4">
      <div data-controller="slug" data-slug-add-date-prefix-value="true">
        <%= f.text_field :title,
            data: {
              "slug-target": "input_text"
            },
            "data-action": "focusout->slug#generatePath" %>
        <%= f.text_field :slug,
            data: {
              "slug-target": "output_text"
            } %>
      </div>
      <%= f.select :author_id, Panda::Core::User.admins.map { |u| [u.name, u.id] } %>
      <%= f.datetime_field :published_at %>
      <%= f.select :status, options_for_select([["Active", "active"], ["Draft", "draft"], ["Hidden", "hidden"], ["Archived", "archived"]], selected: post.status) %>
    </div>
  <% end %>

  <% editor_id = "editor_#{dom_id(post, :content)}" %>
  <div data-controller="editor-form"
       data-editor-form-editor-id-value="<%= editor_id %>">
    <%= f.hidden_field :content,
        data: {
          editor_form_target: "hiddenField",
          initial_content: editor_content_for(post, local_assigns[:preserved_content])
        },
        "data-action": "change->editor-form#handleContentChange" %>
    <div id="<%= editor_id %>"
         data-editor-form-target="editorContainer"
         class="max-w-full block bg-white pt-1 mb-4 mt-2 border border-gray-200 rounded-xl min-h-[300px]">
    </div>
  </div>

  <%= render Panda::Core::Admin::PanelComponent.new do |panel| %>
    <% panel.with_heading_slot { "SEO Settings" } %>
    <div class="space-y-4">
      <%= f.text_field :seo_title, { meta: "Max 70 characters. Leave blank to use post title." } %>
      <%= f.text_area :seo_description, { rows: 3, meta: "Max 160 characters. Leave blank to use post excerpt." } %>
      <%= f.text_field :seo_keywords, { meta: "Comma-separated keywords for search engines." } %>
      <%= f.radio_button_group :seo_index_mode,
          [["Visible to search engines", "visible"], ["Hidden from search engines", "invisible"]],
          { meta: "Control how search engines index this post." } %>
      <%= f.text_field :canonical_url, { meta: "Optional. Full URL to the canonical version of this post." } %>
    </div>
  <% end %>

  <%= render Panda::Core::Admin::PanelComponent.new do |panel| %>
    <% panel.with_heading_slot { "Social Sharing" } %>
    <div class="space-y-4">
      <%= f.text_field :og_title, { label: "Social Media Title", meta: "Max 60 characters. Leave blank to use SEO title." } %>
      <%= f.text_area :og_description, { label: "Social Media Description", rows: 2, meta: "Max 200 characters. Used on Facebook, LinkedIn, Twitter." } %>
      <%= f.select :og_type,
          options_for_select(
            [["Website", "website"], ["Article", "article"], ["Profile", "profile"], ["Video", "video"], ["Book", "book"]],
            selected: post.og_type
          ),
          { label: "Content Type" } %>
      <%= f.file_field :og_image, {
        label: "Social Media Image",
        meta: "Recommended: 1200Ã—630px (1.91:1 ratio). Used on Facebook, LinkedIn, Twitter.",
        accept: "image/png,image/jpeg,image/jpg,image/webp",
        with_cropper: true,
        aspect_ratio: 1.91,
        min_width: 1200,
        min_height: 630
      } %>
      <% if f.object.present? && f.object.persisted? && f.object.og_image.attached? %>
        <div class="mt-2">
          <%= image_tag f.object.og_image.variant(:og_share), class: "max-w-xs rounded border border-gray-300" %>
        </div>
      <% end %>
    </div>
  <% end %>

  <%= render Panda::Core::Admin::FormFooterComponent.new(
    submit_text: f.object.persisted? ? "Update Post" : "Create Post",
    submit_action: "click->editor-form#submit"
  ) %>
<% end %>
