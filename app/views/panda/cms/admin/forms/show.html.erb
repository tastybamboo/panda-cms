<%= render Panda::Core::Admin::ContainerComponent.new do |component| %>
  <% component.with_heading_slot(text: "#{form.name} Submissions", level: 1) do |heading| %>
    <% heading.with_button(text: "Edit Form", href: edit_admin_cms_form_path(form), icon: "fa-solid fa-pen") %>
  <% end %>

  <% if submissions.any? %>
    <%= render Panda::Core::Admin::TableComponent.new(term: "submission", rows: submissions) do |table| %>
      <% display_fields.each_with_index do |field_info, index| %>
        <% field, title, field_type = field_info %>
        <% table.column(title) do |submission| %>
          <% value = submission.data[field] %>
          <% if index == 0 %>
            <%= link_to admin_cms_form_submission_path(form, submission), class: "block-link" do %>
              <% if field_type == "signature" && value.present? && value.start_with?("data:image") %>
                <img src="<%= value %>" alt="Signature" style="max-width: 200px; max-height: 80px; border: 1px solid #e5e7eb;">
              <% else %>
                <%= truncate(value.to_s, length: 80) %>
              <% end %>
            <% end %>
          <% else %>
            <% if field_type == "signature" && value.present? && value.start_with?("data:image") %>
              <img src="<%= value %>" alt="Signature" style="max-width: 200px; max-height: 80px; border: 1px solid #e5e7eb;">
            <% else %>
              <%= truncate(value.to_s, length: 80) %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

      <% table.column("Submitted") do |submission| %>
        <%= time_ago_in_words(submission.created_at) %> ago
      <% end %>
    <% end %>
  <% else %>
    <%= render Panda::Core::Admin::EmptyStateComponent.new(
      icon: "fa-solid fa-inbox",
      title: "No submissions yet",
      description: "Submissions will appear here once the form receives responses."
    ) %>
  <% end %>
<% end %>
